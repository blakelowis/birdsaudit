<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>Retail Audit (Modular) â€” Manual Question Upload</title>
  <meta name="theme-color" content="#47b39d"/>
  
  <style>
    /* --- Base Styles --- */
    @page { size: landscape; }
    :root {
      --bg:#f6faf8; --card:#ffffff; --ink:#1f2937; --muted:#667085; --border:#e6eae7;
      --brand:#0ea5e9; --accent:#47b39d; --accent2:#10b981; --ring:#e5e7eb;
      --touch: 44px; --danger:#ef4444;
    }
    * { box-sizing:border-box; }
    html, body { height:100%; margin:0; }
    body { background:var(--bg); color:var(--ink); font:14px/1.45 system-ui,-apple-system,sans-serif; -webkit-tap-highlight-color:transparent; padding-bottom: 84px; }
    
    /* --- Layout Components --- */
    header { position:sticky; top:0; z-index:50; background:#111827; color:#fff; padding:12px 16px; display:flex; align-items:center; gap:12px; flex-wrap:wrap; }
    header h1 { font-size:18px; margin:0; display:flex; gap:10px; align-items:center; }
    .brand-chip { width:28px; height:28px; border-radius:8px; border:1px solid #374151; background:#fff; overflow:hidden; display:grid; place-items:center; }
    .brand-chip img { max-width:100%; max-height:100%; display:block; }
    .actions { display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-left:auto; }
    
    .wrap { max-width:1120px; margin:0 auto; padding:14px; }
    .card { background:var(--card); border:1px solid var(--border); border-radius:14px; padding:14px; box-shadow:0 1px 2px rgba(0,0,0,.06); margin-bottom:12px; }
    
    /* --- Buttons & Inputs --- */
    .btn { appearance:none; border:none; border-radius:10px; padding:10px 12px; font-weight:700; cursor:pointer; color:#fff; background:var(--accent); min-height: var(--touch); }
    .btn.ghost { background:transparent; border:2px solid #fff; color:#fff; }
    .btn.green { background:var(--accent2); }
    .btn.small { padding:6px 8px; border-radius:8px; min-height: 32px; }

    /* --- Score & Stats --- */
    .scorecard { display:flex; gap:18px; align-items:center; flex-wrap:wrap; }
    .donut { width:120px; height:120px; }
    .stat b { font-size:1.25rem; }
    .hint { color:var(--muted); font-size:.95rem; }

    /* --- Questions & Answers --- */
    .q { border-top:1px dashed var(--border); padding:14px 0; margin-top:12px; }
    .q:first-child { border-top:none; }
    .qtitle { font-weight:700; font-size:1rem; line-height:1.35; }
    .answers { display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-top:10px; }
    .answers label { border: 2px solid var(--border); padding: 10px 14px; border-radius: 12px; background: #fff; cursor:pointer; font-weight:700; }
    .answers input[type="radio"] { position: absolute; opacity: 0; width:0; height:0; }
    
    /* Checked State */
    .answers label:has(input:checked) { border-color: var(--brand); background: linear-gradient(90deg, var(--brand), #60a5fa); color: #fff; }

    /* --- Media Queries --- */
    @media (max-width: 720px) {
      header .actions { width: 100%; justify-content: flex-start; }
    }
    @media (prefers-color-scheme: dark) {
      :root { --bg:#0b1411; --card:#0f1a16; --ink:#f1f5f9; --muted:#9aa4b2; --border:#1f2b25; }
      body { background:var(--bg); color:var(--ink); }
      .card { background: #0f1a16; }
    }
  </style>

  <link rel="manifest" href="manifest.json">
</head>
<body>

  <header>
    <h1><span class="brand-chip"><img id="hdrLogo" alt="Logo"/></span> Birds Audit</h1>
    <div class="actions">
      <label class="btn ghost">Load JSON <input id="seedPicker" type="file" accept="application/json" hidden /></label>
      <button class="btn ghost" id="saveBtn">Save</button>
      <button class="btn green" id="exportBtn">Export HTML</button>
    </div>
  </header>

  <div class="wrap">
    <section id="meta" class="card">
      <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap:15px;">
        <label class="hint">Store Name<input id="storeName" type="text" style="width:100%; padding:8px; border-radius:8px; border:1px solid var(--border);"></label>
        <label class="hint">Auditor<input id="auditorName" type="text" style="width:100%; padding:8px; border-radius:8px; border:1px solid var(--border);"></label>
        <label class="hint">Date<input id="auditDate" type="date" style="width:100%; padding:8px; border-radius:8px; border:1px solid var(--border);"></label>
      </div>
    </section>

    <main id="pane" class="card">
      <div class="hint">No questions loaded. Please upload a .json question set to begin.</div>
    </main>

    <section id="actionPanel" class="card">
      <h3>Action Plan</h3>
      <div id="apBody">No issues flagged yet.</div>
    </section>
  </div>

  <script>
    // --- Service Worker Registration ---
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js').catch(err => console.log('SW failed', err));
      });
    }

    // --- State Management ---
    let state = { meta: {}, sectors: {} };

    // Placeholder Logo
    const EMBEDDED_LOGO = 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100"><circle cx="50" cy="50" r="40" fill="%2347b39d"/></svg>';
    document.getElementById('hdrLogo').src = EMBEDDED_LOGO;

    // Load JSON Logic
    document.getElementById('seedPicker').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(evt) {
        try {
          state.sectors = JSON.parse(evt.target.result);
          renderApp();
        } catch(err) {
          alert("Error parsing JSON file.");
        }
      };
      reader.readAsText(file);
    });

    function renderApp() {
      const pane = document.getElementById('pane');
      pane.innerHTML = '';
      
      // Simple rendering of sectors/questions
      Object.keys(state.sectors).forEach(key => {
        const sector = state.sectors[key];
        const secEl = document.createElement('div');
        secEl.innerHTML = `<h2>${sector.title}</h2>`;
        
        sector.categories?.forEach(cat => {
          const catEl = document.createElement('div');
          catEl.innerHTML = `<h3>${cat.name}</h3>`;
          
          cat.questions?.forEach(q => {
            const qEl = document.createElement('div');
            qEl.className = 'q';
            qEl.innerHTML = `
              <div class="qtitle">${q.text}</div>
              <div class="answers">
                <label><input type="radio" name="q_${q.id}" value="Pass"> Pass</label>
                <label><input type="radio" name="q_${q.id}" value="Fail"> Fail</label>
                <label><input type="radio" name="q_${q.id}" value="NA"> N/A</label>
              </div>
            `;
            catEl.appendChild(qEl);
          });
          secEl.appendChild(catEl);
        });
        pane.appendChild(secEl);
      });
    }

    // Save Button
    document.getElementById('saveBtn').addEventListener('click', () => {
      localStorage.setItem('audit_backup', JSON.stringify(state));
      alert("Progress saved locally!");
    });
  </script>
</body>
</html>
